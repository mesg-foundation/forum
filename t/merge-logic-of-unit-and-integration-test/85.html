<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>Merge logic of unit and integration test - Engine - MESG Community</title>
    <meta name="description" content="Hey guys, 
I was reading a couple of unit and integration tests files and most of the tests are exactly the same. 
If we exclude the lines for mocking the unit tests, the lines are exactly the same. 
Shouldn’t we merge i&amp;hellip;">
    <meta name="generator" content="Discourse 2.5.0.beta5 - https://github.com/discourse/discourse version 00aab498297cba8f977c1e0eb17b7d38ff06cc68">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/9f11b6ddfa02bffdbec79487592a0573a0236cb5_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/53630361a40ad76e1733dd0b0f486e9ae2f4f4d6_2_180x180.png">
<meta name="theme-color" content="#491e8c">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="85.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.mesg.com","potentialAction":{"@type":"SearchAction","target":"https://forum.mesg.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="MESG Community Search">

      <link href="../../stylesheets/desktop_3_52e3411e87658e862890db7bd06899cf49ad5f59.css%3F__ws=forum.mesg.com.css" media="all" rel="stylesheet" data-target="desktop" data-theme-id="7"/>
      <link href="../../stylesheets/desktop_theme_7_bf4f2d3d8a71e6ee907065be9a79df3d849bd29c.css%3F__ws=forum.mesg.com.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="7"/>
    
    <meta id="data-ga-universal-analytics" data-tracking-code="UA-117583862-1" data-json="{&quot;cookieDomain&quot;:&quot;auto&quot;}" data-auto-link-domains="">

<link rel="preload" href="../../assets/google-universal-analytics-00f5cdf7dfd45cba1ae2d258c3366c371c5671023250abbd964a1f16fc2c11a7.js" as="script">
<script src="../../assets/google-universal-analytics-00f5cdf7dfd45cba1ae2d258c3366c371c5671023250abbd964a1f16fc2c11a7.js"></script>


        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Merge logic of unit and integration test&#39;" href="85.rss" />
    <meta property="og:site_name" content="MESG Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.mesg.com/uploads/default/original/1X/55dc05831fcfbf2dd0677c9ae39099094e85cc07.png" />
<meta property="og:image" content="https://forum.mesg.com/uploads/default/original/1X/55dc05831fcfbf2dd0677c9ae39099094e85cc07.png" />
<meta property="og:url" content="https://forum.mesg.com/t/merge-logic-of-unit-and-integration-test/85" />
<meta name="twitter:url" content="https://forum.mesg.com/t/merge-logic-of-unit-and-integration-test/85" />
<meta property="og:title" content="Merge logic of unit and integration test" />
<meta name="twitter:title" content="Merge logic of unit and integration test" />
<meta property="og:description" content="Hey guys,  I was reading a couple of unit and integration tests files and most of the tests are exactly the same.  If we exclude the lines for mocking the unit tests, the lines are exactly the same.  Shouldn’t we merge integration and unit tests asserts and find a way to separate the configuration of each case?  The other argument is to have only one set of test of maintainability. Having 2 set of tests is harder to maintain and we don’t always think to update a test in unit and integration file..." />
<meta name="twitter:description" content="Hey guys,  I was reading a couple of unit and integration tests files and most of the tests are exactly the same.  If we exclude the lines for mocking the unit tests, the lines are exactly the same.  Shouldn’t we merge integration and unit tests asserts and find a way to separate the configuration of each case?  The other argument is to have only one set of test of maintainability. Having 2 set of tests is harder to maintain and we don’t always think to update a test in unit and integration file..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="3 ❤" />
<meta property="article:published_time" content="2018-10-07T10:47:07+00:00" />
<meta property="og:ignore_canonical" content="true" />



    <script type="application/ld+json">{"@context":"http://schema.org","@type":"QAPage","name":"Merge logic of unit and integration test","mainEntity":{"@type":"Question","name":"Merge logic of unit and integration test","text":"Hey guys,\n\nI was reading a couple of unit and integration tests files and most of the tests are exactly the same.\n\nIf we exclude the lines for mocking the unit tests, the lines are exactly the same.\n\nShouldn’t we merge integration and unit tests asserts and find a way to separate the configuration o&hellip;","upvoteCount":0,"answerCount":0,"dateCreated":"2018-10-07T10:47:07.220Z","author":{"@type":"Person","name":"Nicolas"}}}</script>
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png" alt="MESG Community" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="85.html">Merge logic of unit and integration test</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/development.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/development/engine.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Engine</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Nicolas.html'><span itemprop='name'>Nicolas</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="85.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-10-07T10:47:07Z' class='post-time'>
                October 7, 2018, 10:47am
              </time>
              <meta itemprop='dateModified' content='2018-10-07T10:47:07Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Hey guys,</p>
<p>I was reading a couple of unit and integration tests files and most of the tests are exactly the same.<br>
If we exclude the lines for mocking the unit tests, the lines are exactly the same.</p>
<p>Shouldn’t we merge integration and unit tests asserts and find a way to separate the configuration of each case?</p>
<p>The other argument is to have only one set of test of maintainability. Having 2 set of tests is harder to maintain and we don’t always think to update a test in unit and integration files.</p>
<p>I create a small POC on the <code>daemon</code> package (that is not Newable and use a shared <code>defaultContainer</code> variable to access the container instance):</p>
<pre><code class="lang-auto">func TestLogs(t *testing.T) {
	// `go test` command accept a `-short` flag that is meant to accelerate test.
	if testing.Short() {
		defaultContainer = new(mocks.Container)
	}

	// Other possible condition, if the interface typed variable is actually a mock, we can cast it and configure the mock
	if mockContainer, ok := defaultContainer.(*mocks.Container); ok {
		fmt.Println("it's a mock")
		r, _ := io.Pipe()
		mockContainer.On("ServiceLogs", mock.Anything).Return(r, nil)
	} else {
		// Require config for integration test
		startForTest()
	}

	// Execute the same logic and asserts
	reader, err := Logs()
	require.Nil(t, err)
	require.NotNil(t, reader)
}
</code></pre>
<p>What do you think <a class="mention-group" href="../../groups/core.html">@core</a> ?</p>
        </div>

        <meta itemprop='headline' content='Merge logic of unit and integration test'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="../automatize-manual-testing-for-core-true-integration-testing/94.html" itemprop='item'>
                      <meta itemprop='url' content='https://forum.mesg.com/t/automatize-manual-testing-for-core-true-integration-testing/94'>
                      <meta itemprop='position' content='2'>
                      <span itemprop='name'>Automatize Manual Testing for Core (True Integration Testing)</span>
                    </a>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/ilgooz.html'><span itemprop='name'>ilgooz</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="85.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2018-10-07T11:24:43Z'>
              <time itemprop='dateModified' datetime='2018-10-07T11:26:37Z' class='post-time'>
                October 7, 2018, 11:26am
              </time>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Merging integration tests and unit tests like this is doable. As you said, it’ll make the test maintenance easier and we’ll have the same tests for both unit and integration tests.</p>
<p>As a downside, it’ll complicate the tests because we’ll have more if-else statements to check the test type and for bigger tests it can become an issue. Merging tests like this feels like a monolithic approach to me, easy to do but in a long term can be quite confusing and could get out of control.</p>
<p>I prefer having much stupid tests with less lines in it as possible. An ideal test should be small, should be targeted and shouldn’t be updated too often. But having monolithic tests breaks this rules and introduces complexity in tests itself.</p>
        </div>

        <meta itemprop='headline' content='Merge logic of unit and integration test'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/krhubert.html'><span itemprop='name'>krhubert</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="85.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-10-08T07:11:14Z' class='post-time'>
                October 8, 2018,  7:11am
              </time>
              <meta itemprop='dateModified' content='2018-10-08T07:11:14Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I think what we should do it to avoid duplicaiton of the same test with mock and in integration. So for know we have solution with integration tag and it’s good (same with short), but we should only proivde one test because testing the same thing with/without mock doesn’t brings any value.</p>
        </div>

        <meta itemprop='headline' content='Merge logic of unit and integration test'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Nicolas.html'><span itemprop='name'>Nicolas</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="85.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2018-10-08T07:55:33Z'>
              <time itemprop='dateModified' datetime='2018-10-08T07:56:57Z' class='post-time'>
                October 8, 2018,  7:56am
              </time>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Actually, I think we don’t need most of the integration test we have. Let me explain:</p>
<p>Let’s say we have 2 packages: <code>container</code>, <code>service</code>.<br>
<code>container</code> uses an external system: docker.<br>
<code>service</code>doesn’t use any external system directly but use <code>container</code>.</p>
<p>In this case, <code>container</code> should have <strong>integration</strong> tests. This way we can be 100% sure that everything is working. Then, we <strong>could</strong> also have unit test to make sure if we break stuff we can know really fast. But again, the unit test <strong>are be optional</strong> because they will <strong>never</strong> give us 100% trust on test on the package.</p>
<p>Then, <code>service</code> should have only <strong>unit test</strong> that use a mock of <code>container</code>. As <code>service</code> doesn’t internally really on slow external system, we can run the test really fast (with a mock of <code>container</code> of course).</p>
<p>At the end, I think we don’t ask the right question if we need integration test and/or unit test. I think the right question is: shouldn’t we have only 1 way to test a package?</p>
<p>Whenever it’s integration or unit test, it’s more about fast or slow test. So the <code>-short</code> flag and the <code>t.Skip</code> function could prevent slow test to be executed when we don’t want.<br>
Quote from <a href="https://golang.org/pkg/testing:">https://golang.org/pkg/testing:</a></p>
<blockquote>
<p>Tests and benchmarks may be skipped if not applicable with a call to the Skip method of *T and *B:</p>
<pre><code class="lang-auto">func TestTimeConsuming(t *testing.T) {
    if testing.Short() {
       t.Skip("skipping test in short mode.")
   }
   ...
}
</code></pre>
</blockquote>
<p>But again, we could reach the same functionality with the <code>-tags</code> and the header in test files (like <code>integration</code> tag)</p>
<p><a class="mention" href="../../u/krhubert.html">@krhubert</a> <a class="mention" href="../../u/ilgooz.html">@ilgooz</a> <a class="mention" href="../../u/anthony.html">@Anthony</a> what are you feedbacks?</p>
        </div>

        <meta itemprop='headline' content='Merge logic of unit and integration test'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/ilgooz.html'><span itemprop='name'>ilgooz</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="85.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2018-10-08T13:00:29Z'>
              <time itemprop='dateModified' datetime='2018-10-08T13:30:36Z' class='post-time'>
                October 8, 2018,  1:30pm
              </time>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a class="mention" href="../../u/nicolas.html">@Nicolas</a> When you put it this way, I totally agree with you. I don’t see any reason keeping integration tests except for the container package. Let’s validate this idea and make sure it’s right.</p>
<p>For container package, we must have the integration tests. We can/should also keep the unit tests for container package for running tests faster while developing the container package.</p>
<p>I’m not so sure about combining unit tests and integration tests together for container package because it might complicate the tests. If we decide to combine them, I’m also in favor of using <em>-short</em> flag for disabling integration tests instead of enabling integration tests with <em>tags=integration</em>. Short flag makes a bit more sense to use in our case because we’ll not heavily depend on integration testing.</p>
        </div>

        <meta itemprop='headline' content='Merge logic of unit and integration test'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/ilgooz.html'><span itemprop='name'>ilgooz</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="85.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2018-10-08T13:08:59Z'>
              <time itemprop='dateModified' datetime='2018-10-08T13:21:54Z' class='post-time'>
                October 8, 2018,  1:21pm
              </time>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>In addition to integration testing of core:</p>
<p>There is always a margin for mistakes with unit testing too. So we cannot never be sure if core works well with docker or other external services as it is suppose to be if we don’t have integration tests in the higher level.</p>
<p>I think we can still have some integration tests but not required to have them in the core itself. We can have integration tests within another languages or even with some bash scripts. We can integration test the core through the gRPC API directly.</p>
<p>We don’t even need to check if a network or container is created with this kind of testing. Lets just create a few scenarios about coupling a few services together and compare the expected task results, event data, service list etc. through the gRPC API.</p>
        </div>

        <meta itemprop='headline' content='Merge logic of unit and integration test'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/krhubert.html'><span itemprop='name'>krhubert</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="85.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-10-09T07:46:20Z' class='post-time'>
                October 9, 2018,  7:46am
              </time>
              <meta itemprop='dateModified' content='2018-10-09T07:46:20Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote group-team" data-post="4" data-topic="85">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.mesg.com/nicolas/40/10_1.png" class="avatar"> Nicolas:</div>
<blockquote>
<p>Let’s say we have 2 packages: <code>container</code> , <code>service</code> .<br>
<code>container</code> uses an external system: docker.<br>
<code>service</code> doesn’t use any external system directly but use <code>container</code> .</p>
</blockquote>
</aside>
<p>You choose the wrong two packages <img src="../../images/emoji/twitter/slight_smile.png%3Fv=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"> What I mean by that, here the container and the service should have integration tests.</p>
<p>The <code>service</code> imports <code>container</code> but… The container is just a wrapper for docker api, and the <code>service</code> is just wrapper for <code>container</code> which is wrapper for docker api. Those two packages are super thight releated with docker and at least one (<code>service</code>) of them shouldn’t.</p>
<p>But in general if you have more SOLID code this should work as you described</p>
<aside class="quote group-team" data-post="4" data-topic="85">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.mesg.com/nicolas/40/10_1.png" class="avatar"> Nicolas:</div>
<blockquote>
<p>At the end, I think we don’t ask the right question if we need integration test and/or unit test. I think the right question is: shouldn’t we have only 1 way to test a package?</p>
</blockquote>
</aside>
<p>Nobody said that we need only one of those type tests. And about 1 way, no we shouldn’t. Tests should be smart, if you can tests something with unit test go with them, if not go with other tests (e2e, functional, integration etc…).</p>
        </div>

        <meta itemprop='headline' content='Merge logic of unit and integration test'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Nicolas.html'><span itemprop='name'>Nicolas</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="85.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2018-10-10T09:43:44Z'>
              <time itemprop='dateModified' datetime='2018-10-10T09:45:19Z' class='post-time'>
                October 10, 2018,  9:45am
              </time>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote group-team" data-post="7" data-topic="85">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.mesg.com/krhubert/40/9_1.png" class="avatar"> krhubert:</div>
<blockquote>
<p>Nobody said that we need only one of those type tests. And about 1 way, no we shouldn’t. Tests should be smart, if you can tests something with unit test go with them, if not go with other tests (e2e, functional, integration etc…).</p>
</blockquote>
</aside>
<p>I express my thought the wrong way. I should not say “only 1 way to test a package” but only one test per thing to test (can be integration, unit, etc…). I would like to avoid to test the same feature, with the same path, in differents ways. Example:<br>
In <code>service</code> package:</p>
<ul>
<li>
<code>TestIntegrationStartWith2DependenciesIntegration</code> / <code>TestStartWith2Dependencies</code>
</li>
<li>
<code>TestIntegrationStartServiceIntegration</code> / <code>TestStartService</code>.</li>
</ul>
<p>My suggestion is to test with only one test a feature using the best tool.<br>
Example:</p>
<ul>
<li>For a “happy path” of the <code>service.Start</code> function, it should be done by using the real Docker Engine, so integration test.</li>
<li>For a path with error of the same <code>service.Start</code> function, we should use a mock to inject precisely the desired error and test if the return of the function is correct.</li>
</ul>
        </div>

        <meta itemprop='headline' content='Merge logic of unit and integration test'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
