<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>Use of config in the Core - Engine - MESG Community</title>
    <meta name="description" content="In the core we are using the package config in 2 different ways: 
As a dependency injected in a package
Pro: We could mock it easily 
Con: We need to pass it pretty much everywhere and that become a de-facto dependency 
A&amp;hellip;">
    <meta name="generator" content="Discourse 2.5.0.beta5 - https://github.com/discourse/discourse version 00aab498297cba8f977c1e0eb17b7d38ff06cc68">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/9f11b6ddfa02bffdbec79487592a0573a0236cb5_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/53630361a40ad76e1733dd0b0f486e9ae2f4f4d6_2_180x180.png">
<meta name="theme-color" content="#491e8c">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="238.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.mesg.com","potentialAction":{"@type":"SearchAction","target":"https://forum.mesg.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="MESG Community Search">

      <link href="../../stylesheets/desktop_3_52e3411e87658e862890db7bd06899cf49ad5f59.css%3F__ws=forum.mesg.com.css" media="all" rel="stylesheet" data-target="desktop" data-theme-id="7"/>
      <link href="../../stylesheets/desktop_theme_7_bf4f2d3d8a71e6ee907065be9a79df3d849bd29c.css%3F__ws=forum.mesg.com.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="7"/>
    
    <meta id="data-ga-universal-analytics" data-tracking-code="UA-117583862-1" data-json="{&quot;cookieDomain&quot;:&quot;auto&quot;}" data-auto-link-domains="">

<link rel="preload" href="../../assets/google-universal-analytics-00f5cdf7dfd45cba1ae2d258c3366c371c5671023250abbd964a1f16fc2c11a7.js" as="script">
<script src="../../assets/google-universal-analytics-00f5cdf7dfd45cba1ae2d258c3366c371c5671023250abbd964a1f16fc2c11a7.js"></script>


        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Use of config in the Core&#39;" href="238.rss" />
    <meta property="og:site_name" content="MESG Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.mesg.com/uploads/default/original/1X/55dc05831fcfbf2dd0677c9ae39099094e85cc07.png" />
<meta property="og:image" content="https://forum.mesg.com/uploads/default/original/1X/55dc05831fcfbf2dd0677c9ae39099094e85cc07.png" />
<meta property="og:url" content="https://forum.mesg.com/t/use-of-config-in-the-core/238" />
<meta name="twitter:url" content="https://forum.mesg.com/t/use-of-config-in-the-core/238" />
<meta property="og:title" content="Use of config in the Core" />
<meta name="twitter:title" content="Use of config in the Core" />
<meta property="og:description" content="In the core we are using the package config in 2 different ways:  As a dependency injected in a package Pro: We could mock it easily  Con: We need to pass it pretty much everywhere and that become a de-facto dependency  As a singleton Pro: Ease of use  Con: Creates a string dependency   Both solutions are valid but we need to make sure we choose only one to not have any confusion in the code with sometime dependencies and sometime singleton.  Both solution needs some modifications in the code. I..." />
<meta name="twitter:description" content="In the core we are using the package config in 2 different ways:  As a dependency injected in a package Pro: We could mock it easily  Con: We need to pass it pretty much everywhere and that become a de-facto dependency  As a singleton Pro: Ease of use  Con: Creates a string dependency   Both solutions are valid but we need to make sure we choose only one to not have any confusion in the code with sometime dependencies and sometime singleton.  Both solution needs some modifications in the code. I..." />
<meta property="article:published_time" content="2019-01-29T07:24:11+00:00" />
<meta property="og:ignore_canonical" content="true" />



    <script type="application/ld+json">{"@context":"http://schema.org","@type":"QAPage","name":"Use of config in the Core","mainEntity":{"@type":"Question","name":"Use of config in the Core","text":"In the core we are using the package config in 2 different ways:\n\nAs a dependency injected in a package\n\nPro: We could mock it easily\n\nCon: We need to pass it pretty much everywhere and that become a de-facto dependency\n\nAs a singleton\n\nPro: Ease of use\n\nCon: Creates a string dependency\n\nBoth solutio&hellip;","upvoteCount":0,"answerCount":1,"dateCreated":"2019-01-29T07:24:11.176Z","author":{"@type":"Person","name":"Anthony"},"acceptedAnswer":{"@type":"Answer","text":"Everything is now passed as a dependency and we don’t use any singleton anymore","upvoteCount":0,"dateCreated":"2019-12-26T02:21:43.446Z","url":"https://forum.mesg.com/t/use-of-config-in-the-core/238/5","author":{"@type":"Person","name":"Anthony"}}}}</script>
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png" alt="MESG Community" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="238.html">Use of config in the Core</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/development.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/development/engine.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Engine</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Anthony.html'><span itemprop='name'>Anthony</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="238.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2019-01-29T07:24:11Z'>
              <time itemprop='dateModified' datetime='2019-01-29T07:24:26Z' class='post-time'>
                January 29, 2019,  7:24am
              </time>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>In the core we are using the package config in 2 different ways:</p>
<h2>As a dependency injected in a package</h2>
<p>Pro: We could mock it easily<br>
Con: We need to pass it pretty much everywhere and that become a de-facto dependency</p>
<h2>As a singleton</h2>
<p>Pro: Ease of use<br>
Con: Creates a string dependency</p>
<hr>
<p>Both solutions are valid but we need to make sure we choose only one to not have any confusion in the code with sometime dependencies and sometime singleton.</p>
<p>Both solution needs some modifications in the code. If singleton, we need to have a <strong>real singleton</strong> the <strong>New</strong> function should not be exposed. If dependency we need to remove the <strong>Global</strong> function and do everything in the <strong>New</strong> method.</p>
<p>Would like to have your feedbacks on that <img src="../../images/emoji/twitter/slight_smile.png%3Fv=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>This subject came from this discussion on github <a href="https://github.com/mesg-foundation/core/pull/737#discussion_r251319159" rel="nofollow noopener">https://github.com/mesg-foundation/core/pull/737#discussion_r251319159</a></p>
        </div>

        <meta itemprop='headline' content='Use of config in the Core'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/krhubert.html'><span itemprop='name'>krhubert</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="238.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-01-29T08:39:39Z' class='post-time'>
                January 29, 2019,  8:39am
              </time>
              <meta itemprop='dateModified' content='2019-01-29T08:39:39Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>There are more solutions to this.</p>
<ol>
<li>A global variable (we don’t need singleton because of it just simulation of a global variable)</li>
</ol>
<pre><code class="lang-auto">package config

var Cfg *Config

type Config struct {
  Bar string
}

func Init() error {
 Cfg = &amp;Config{Bar: "bar"}
 return nil
}

package main

import "config"
import "a"

func main() {
  config.Init()
  a.New().foo()
}

package a

import "config"

type A struct {
}

func New() *A {
  return &amp;A{}
}

func (a *A) foo() {
  fmt.Println(config.Cfg.Bar)
}
</code></pre>
<ol start="2">
<li>Pass config</li>
</ol>
<pre><code class="lang-auto">package config

type Config struct {
  Bar string
}

func New() (*Config) {
 return &amp;Config{Bar: "bar"}
}

package main

import "config"
import "a"

func main() {
  cfg := config.New()
  a.New(cfg).foo()
}

package a

import "config"

type A struct {
  cfg *config.Config
}

func New(cfg *config.Config) *A {
  return &amp;A{cfg: cfg}
}

func (a *A) foo() {
  fmt.Println(a.cfg.Bar)
}
</code></pre>
<ol start="3">
<li>Pass part of config</li>
</ol>
<pre><code class="lang-auto">package config

type BarConfig struct {
  Bar string
}

type Config struct {
  Bar BarConfig
}

func New() (*Config) {
 return &amp;Config{Bar: BarConfig{"bar"}}
}

package main

import "config"
import "a"

func main() {
  cfg := config.New()
  a.New(cfg.BarConfig).foo()
}

package a

import "config"

type A struct {
  cfg *config.BarConfig
}

func New(cfg *config.BarConfig) *A {
  return &amp;A{cfg: cfg}
}

func (a *A) foo() {
  fmt.Println(a.cfg.Bar)
}
</code></pre>
<ol start="4">
<li>Each package create it’s own options to configure</li>
</ol>
<pre><code class="lang-auto">package config

type BarConfig struct {
  Bar string
}

type Config struct {
  Bar BarConfig
}

func New() (*Config) {
 return &amp;Config{Bar: BarConfig{"bar"}}
}

package main

import "config"
import "a"

func main() {
  cfg := config.New()
  a.New(&amp;a.Config{Bar: cfg.BarConfig}).foo()
}

package a

import "config"

type Config struct {
  Bar string
}

type A struct {
  cfg *Config
}

func New(cfg *Config) *A {
  return &amp;A{cfg: cfg}
}

func (a *A) foo() {
  fmt.Println(a.cfg.Bar)
}
</code></pre>
<div class="poll" data-poll-status="open" data-poll-public="true" data-poll-results="always" data-poll-type="regular" data-poll-name="poll">
<div>
<div class="poll-container">
<ul>
<li data-poll-option-id="ea7d0c8f93f8f53c17dfde0cc76d443a">1 A global variable</li>
<li data-poll-option-id="1822ff717e2f020104429004cb4affbb">2 Pass config</li>
<li data-poll-option-id="e18bbf7fac2b35e50c9e6a57228ac6c5">3 Pass part of config</li>
<li data-poll-option-id="669443cf3f21f7cdb58211e7d3b5158c">4 Each package create it’s own options to configure</li>
</ul>
</div>
<div class="poll-info">
<p>
<span class="info-number">0</span>
<span class="info-label">voters</span>
</p>
</div>
</div>
</div>
        </div>

        <meta itemprop='headline' content='Use of config in the Core'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Nicolas.html'><span itemprop='name'>Nicolas</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="238.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-01-29T10:19:01Z' class='post-time'>
                January 29, 2019, 10:19am
              </time>
              <meta itemprop='dateModified' content='2019-01-29T10:19:01Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I vote for singleton.</p>
<p>Having each package with different config will result in a mess. Some package needs config for other package because of the container architecture we have.</p>
        </div>

        <meta itemprop='headline' content='Use of config in the Core'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/krhubert.html'><span itemprop='name'>krhubert</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="238.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-02-01T08:58:32Z' class='post-time'>
                February 1, 2019,  8:58am
              </time>
              <meta itemprop='dateModified' content='2019-02-01T08:58:32Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Singleton is consider by many as antipattern. Also it leads to situation like in service package (described here <a href="https://github.com/mesg-foundation/core/pull/737#discussion_r251319159" rel="nofollow noopener">https://github.com/mesg-foundation/core/pull/737#discussion_r251319159</a>)</p>
        </div>

        <meta itemprop='headline' content='Use of config in the Core'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Anthony.html'><span itemprop='name'>Anthony</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="238.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2019-12-26T02:21:43Z'>
              <time itemprop='dateModified' datetime='2019-12-26T02:21:45Z' class='post-time'>
                December 26, 2019,  2:21am
              </time>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Everything is now passed as a dependency and we don’t use any singleton anymore</p>
        </div>

        <meta itemprop='headline' content='Use of config in the Core'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
