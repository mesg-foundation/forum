<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>Instance on the Network - Engine - MESG Community</title>
    <meta name="description" content="Hey guys, I would like your feedbacks on how to implement the Instance on the Network. 
1. Instance hash calculation needs to change.
Instance hash is calculated with the instances’ env variables. But for security reason&amp;hellip;">
    <meta name="generator" content="Discourse 2.5.0.beta5 - https://github.com/discourse/discourse version 00aab498297cba8f977c1e0eb17b7d38ff06cc68">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/9f11b6ddfa02bffdbec79487592a0573a0236cb5_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/53630361a40ad76e1733dd0b0f486e9ae2f4f4d6_2_180x180.png">
<meta name="theme-color" content="#491e8c">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="406.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.mesg.com","potentialAction":{"@type":"SearchAction","target":"https://forum.mesg.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="MESG Community Search">

      <link href="../../stylesheets/desktop_3_52e3411e87658e862890db7bd06899cf49ad5f59.css%3F__ws=forum.mesg.com.css" media="all" rel="stylesheet" data-target="desktop" data-theme-id="7"/>
      <link href="../../stylesheets/desktop_theme_7_bf4f2d3d8a71e6ee907065be9a79df3d849bd29c.css%3F__ws=forum.mesg.com.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="7"/>
    
    <meta id="data-ga-universal-analytics" data-tracking-code="UA-117583862-1" data-json="{&quot;cookieDomain&quot;:&quot;auto&quot;}" data-auto-link-domains="">

<link rel="preload" href="../../assets/google-universal-analytics-00f5cdf7dfd45cba1ae2d258c3366c371c5671023250abbd964a1f16fc2c11a7.js" as="script">
<script src="../../assets/google-universal-analytics-00f5cdf7dfd45cba1ae2d258c3366c371c5671023250abbd964a1f16fc2c11a7.js"></script>


        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Instance on the Network&#39;" href="406.rss" />
    <meta property="og:site_name" content="MESG Community" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.mesg.com/uploads/default/original/1X/898d9206fbf04e195bccf6b3dbe0eee0e171ca3b.jpeg" />
<meta property="og:image" content="https://forum.mesg.com/uploads/default/original/1X/898d9206fbf04e195bccf6b3dbe0eee0e171ca3b.jpeg" />
<meta property="og:url" content="https://forum.mesg.com/t/instance-on-the-network/406" />
<meta name="twitter:url" content="https://forum.mesg.com/t/instance-on-the-network/406" />
<meta property="og:title" content="Instance on the Network" />
<meta name="twitter:title" content="Instance on the Network" />
<meta property="og:description" content="Hey guys, I would like your feedbacks on how to implement the Instance on the Network.  1. Instance hash calculation needs to change. Instance hash is calculated with the instances’ env variables. But for security reason, the env variables are not save in any database. This cause the problem of not being able to recalculate the instance hash without the original envs. Only the engine that start the instance knows the env and thus the instance hash. This is not something good in order to implemen..." />
<meta name="twitter:description" content="Hey guys, I would like your feedbacks on how to implement the Instance on the Network.  1. Instance hash calculation needs to change. Instance hash is calculated with the instances’ env variables. But for security reason, the env variables are not save in any database. This cause the problem of not being able to recalculate the instance hash without the original envs. Only the engine that start the instance knows the env and thus the instance hash. This is not something good in order to implemen..." />
<meta property="article:published_time" content="2019-09-29T07:14:10+00:00" />
<meta property="og:ignore_canonical" content="true" />



    <script type="application/ld+json">{"@context":"http://schema.org","@type":"QAPage","name":"Instance on the Network","mainEntity":{"@type":"Question","name":"Instance on the Network","text":"Hey guys, I would like your feedbacks on how to implement the Instance on the Network.\n\n1. Instance hash calculation needs to change.\n\nInstance hash is calculated with the instances’ env variables. But for security reason, the env variables are not save in any database. This cause the problem of not &hellip;","upvoteCount":0,"answerCount":1,"dateCreated":"2019-09-29T07:14:10.340Z","author":{"@type":"Person","name":"Nicolas"},"acceptedAnswer":{"@type":"Answer","text":"WIP\n\n<a href="https://forum.mesg.com/t/instance-on-the-network/\&quot;https://github.com/NicolasMahe\&quot;" target=\"_blank\" rel=\"nofollow noopener\">\n\n[NicolasMahe]\n\n<\/a>\n\n<a href="https://forum.mesg.com/t/instance-on-the-network/\&quot;https://github.com/mesg-foundation/engine/pull/1456\&quot;" target=\"_blank\" rel=\"nofollow noopener\">Feature/runners<\/a>\n\nby <a href="https://forum.mesg.com/t/instance-on-the-network/\&quot;https://github.com/NicolasMahe\&quot;" target=\"_blank\" rel=\"nofollow noopener\">NicolasMahe<\/a>\n\non <a href="https://forum.mesg.com/t/instance-on-the-network/\&quot;https://github.com/mesg-foundation/engine/pull/1456\&quot;" target=\"_blank\" rel=\"nofollow noopener\">11:21AM - 01 Nov 19 UTC<\/a>\n\n5 commits\n\nchanged 38 files\n\nwith 2112 additions\n\nand 919 deletions.","upvoteCount":0,"dateCreated":"2019-11-01T11:28:40.754Z","url":"https://forum.mesg.com/t/instance-on-the-network/406/4","author":{"@type":"Person","name":"Nicolas"}}}}</script>
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png" alt="MESG Community" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="406.html">Instance on the Network</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/development.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/development/engine.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Engine</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/proposal.html' class='discourse-tag' rel="tag">proposal</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Nicolas.html'><span itemprop='name'>Nicolas</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="406.html">

            <link itemprop="image" href="../../uploads/default/original/1X/898d9206fbf04e195bccf6b3dbe0eee0e171ca3b.jpeg">

          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2019-09-29T07:14:10Z'>
              <time itemprop='dateModified' datetime='2019-09-29T11:13:53Z' class='post-time'>
                September 29, 2019, 11:13am
              </time>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Hey guys, I would like your feedbacks on how to implement the Instance on the Network.</p>
<h2>1. Instance hash calculation needs to change.</h2>
<p>Instance hash is calculated with the instances’ env variables. But for security reason, the env variables are not save in any database. This cause the problem of not being able to recalculate the instance hash without the original envs. Only the engine that start the instance knows the env and thus the instance hash. This is not something good in order to implement the decentralized network correctly.</p>
<p>The solution is simply the calculate first the hash of the instance envs and to save it in the instance struct. Like this, anyone will be able to recalculate the instance hash without having to know the envs variable.</p>
<p>I already created an issue about this as it’s simple:<br>
<aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/mesg-foundation/engine/issues/1279" target="_blank" rel="nofollow noopener">github.com/mesg-foundation/engine</a>
  </header>
  <article class="onebox-body">
    <a href="https://github.com/NicolasMahe" rel="nofollow noopener">
<img src="../../uploads/default/original/1X/898d9206fbf04e195bccf6b3dbe0eee0e171ca3b.jpeg" class="thumbnail onebox-avatar" width="" height="">
</a>

<h4><a href="https://github.com/mesg-foundation/engine/issues/1279" target="_blank" rel="nofollow noopener">Issue: Change calculation of instance hash</a></h4>

<div class="date" style="margin-top:10px;">
	<div class="user" style="margin-top:10px;">
	opened by <a href="https://github.com/NicolasMahe" target="_blank" rel="nofollow noopener">NicolasMahe</a>
	on <a href="https://github.com/mesg-foundation/engine/issues/1279" target="_blank" rel="nofollow noopener">2019-08-31</a>
	</div>
	<div class="user">
	</div>
</div>

<pre class="content" style="white-space: pre-wrap;">Instance hash is calculated with the instances' env variables. But for security reason, the env variables are not save in any...</pre>

<div class="labels">
 	<span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">enhancement</span>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
<h2>2. Properly define client and validator role</h2>
<p>Both instance sdk create and delete function are doing 2 things:</p>
<ul>
<li>Starting/stopping the docker services</li>
<li>Create/delete the instance object in the database<br>
To implement the decentralized network correctly, we need to separate better those 2 functions in 2 separate steps to define properly what the local engine have to do (client / instance sdk), and what the tendermint validator engine have to do (validator / instance backend).</li>
</ul>
<p>I suggest the following logic:</p>
<h4>Instance creation</h4>
<ol>
<li>In <code>InstanceSDK.Create</code>:
<ol>
<li>Calculate instance hash to check if instance doesn’t already run locally. If yes, return error.</li>
<li>Download source and start instance in docker. Wait for it to start.</li>
<li>Create transaction with message <code>msgCreateInstance</code>. This message contain the data of the instance (service hash and env hash) and also the address of the account that start this instance, we we call it <code>node</code>.</li>
</ol>
</li>
<li>In <code>InstanceBackend.Create</code>
<ol>
<li>Create the instance struct. Calculate its hash.</li>
<li>Check if instance exist in db. If not, create it. If already exist, continue.</li>
<li>Register <code>node</code> as running this instance</li>
</ol>
</li>
</ol>
<h4>Instance deletion</h4>
<p>Basically the same as previous block but in reverse:</p>
<ol>
<li>unregister the node from the blockchain by executing a transaction.</li>
<li>once tx confirmed, stop the local instance in docker</li>
</ol>
<h3>3. List of nodes that runs instances</h3>
<p>Each node will have the responsibility to register and unregister itself from the instance, like this the whole network knows who is running what.<br>
But what is the best way to store them?</p>
<p>We could simply add an array of nodes in the instance struct, but it will require to update the instance object over and over.<br>
I’m suggesting to create a new store where each entry is referencing the instance hash and the node address (similar to ownership sdk). Like this it’s very simple to check if the node is register or can unregister itself.<br>
The big question is “who” is managing this new store? It is directly <code>instance sdk</code>? Is it a new instance runner sdk? See <a href="../immutable-data-on-tendermint/407.html" class="inline-onebox">Immutable data on Tendermint</a> to answer.</p>
        </div>

        <meta itemprop='headline' content='Instance on the Network'>
          <meta itemprop='keywords' content='proposal'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="../immutable-data-on-tendermint/407.html" itemprop='item'>
                      <meta itemprop='url' content='https://forum.mesg.com/t/immutable-data-on-tendermint/407'>
                      <meta itemprop='position' content='3'>
                      <span itemprop='name'>Immutable data on Tendermint</span>
                    </a>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/krhubert.html'><span itemprop='name'>krhubert</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="406.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-09-30T05:09:05Z' class='post-time'>
                September 30, 2019,  5:09am
              </time>
              <meta itemprop='dateModified' content='2019-09-30T05:09:05Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <blockquote>
<p>The solution is simply the calculate first the hash of the instance envs and to save it in the instance struct. Like this,       anyone will be able to recalculate the instance hash without having to know the envs variable.</p>
</blockquote>
<p>Why someone want to recalculate those hashes? If you are able to get the isntance struct why you can’t use instance hash directly?</p>
<blockquote>
<p>Instance creation</p>
</blockquote>
<p>how/when instance sdk create will be called? SDK firsth then msgCreateInstance will call Backend right?</p>
        </div>

        <meta itemprop='headline' content='Instance on the Network'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Nicolas.html'><span itemprop='name'>Nicolas</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="406.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-10-31T11:26:30Z' class='post-time'>
                October 31, 2019, 11:26am
              </time>
              <meta itemprop='dateModified' content='2019-10-31T11:26:30Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote group-team" data-post="1" data-topic="406">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.mesg.com/nicolas/40/10_2.png" class="avatar"> Nicolas:</div>
<blockquote>
<p>The big question is “who” is managing this new store? It is directly <code>instance sdk</code> ? Is it a new instance runner sdk? See <a href="../immutable-data-on-tendermint/407.html">Immutable data on Tendermint</a> to answer.</p>
</blockquote>
</aside>
<p>The runner should be a new dedicated sdk.<br>
The instance creation should be managed by the runner backend (like the ownership) when a runner is created.<br>
The creation of the runner should contains all info needed to create the instance and of course the runner.<br>
The instance sdk should not expose any write function, only read ones.</p>
        </div>

        <meta itemprop='headline' content='Instance on the Network'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='MESG Foundation'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.mesg.com/uploads/default/original/1X/81100f444852fa77ae7cd5276c5683e9a8cfc9a2.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Nicolas.html'><span itemprop='name'>Nicolas</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="406.html">

            <link itemprop="image" href="../../uploads/default/original/1X/26944398294eb78d5fcd9c0ac79f47a8ba160661.jpeg">

          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2019-11-01T11:28:40Z'>
              <time itemprop='dateModified' datetime='2019-12-26T01:05:36Z' class='post-time'>
                December 26, 2019,  1:05am
              </time>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>WIP<br>
<aside class="onebox githubpullrequest">
  <header class="source">
      <a href="https://github.com/mesg-foundation/engine/pull/1456" target="_blank" rel="nofollow noopener">github.com/mesg-foundation/engine</a>
  </header>
  <article class="onebox-body">
      <a href="https://github.com/NicolasMahe" target="_blank" rel="nofollow noopener">
    <img alt="NicolasMahe" src="../../uploads/default/original/1X/26944398294eb78d5fcd9c0ac79f47a8ba160661.jpeg" class="thumbnail onebox-avatar" width="90" height="90">
  </a>

<h4>
  <a href="https://github.com/mesg-foundation/engine/pull/1456" target="_blank" rel="nofollow noopener">Feature/runners</a>
</h4>

<div class="date">
  by <a href="https://github.com/NicolasMahe" target="_blank" rel="nofollow noopener">NicolasMahe</a>
  on <a href="https://github.com/mesg-foundation/engine/pull/1456" target="_blank" rel="nofollow noopener">11:21AM - 01 Nov 19 UTC</a>
</div>

<div class="github-commit-stats">
  <strong>5 commits</strong>
  changed <strong>38 files</strong>
  with <strong>2112 additions</strong>
  and <strong>919 deletions</strong>.
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
        </div>

        <meta itemprop='headline' content='Instance on the Network'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../index.html' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../categories.html' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
